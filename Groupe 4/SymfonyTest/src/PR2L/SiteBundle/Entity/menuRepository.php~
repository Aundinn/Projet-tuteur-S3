<?php

namespace PR2L\SiteBundle\Entity;

use Doctrine\ORM\EntityRepository;

/**
 * menuRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class menuRepository extends EntityRepository
{
	public function myFindByParent($parent)
	{
  		$qb = $this->createQueryBuilder('a');

  		$qb->where('a.idMenuParent = :parent')
       		->setParameter('parent', $parent)
  		;

 		return $qb
    		->getQuery()
    		->getResult()
  		;
	}
	
	public function getAllMenusParents(){
		$listeMenus = array();
		$sql = 'SELECT libelle, idMenu, idMenuParent, lien, representation, emplacement
		FROM Menu
        WHERE idMenuParent is null';
		$req = $this->db->prepare($sql);
		$req->execute();
		
		while($menu = $req->fetch(PDO::FETCH_OBJ)){
			$listeMenus[] = new Menu($menu);
		}
		$req->closeCursor();
		
		return $listeMenus;
		
	}
    
    public function getAllMenusByParent($numMenuP){
		$listeMenus = array();
		$sql = 'SELECT libelle, idMenu, idMenuParent, lien, representation, emplacement
		FROM Menu
        WHERE idMenuParent = :numMenuP';
		$req = $this->db->prepare($sql);
        $req->bindValue(':numMenuP', $numMenuP);
		$req->execute();
		
		while($menu = $req->fetch(PDO::FETCH_OBJ)){
			$listeMenus[] = new Menu($menu);
		}
		$req->closeCursor();
		
		return $listeMenus;
		
	}
}
